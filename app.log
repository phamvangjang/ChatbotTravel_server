2025-05-19 15:59:42,526 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 15:59:42,537 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 15:59:42,547 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 15:59:42,705 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 15:59:42,706 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:00:04,385 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\travel_assistant.py', reloading
2025-05-19 16:00:08,702 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:00:08,709 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:00:08,717 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:00:08,868 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:00:08,868 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:01:29,056 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:01:29] "GET /docs HTTP/1.1" 200 -
2025-05-19 16:01:29,204 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:01:29] "[36mGET /swaggerui/droid-sans.css HTTP/1.1[0m" 304 -
2025-05-19 16:01:29,311 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:01:29] "[36mGET /swaggerui/swagger-ui.css HTTP/1.1[0m" 304 -
2025-05-19 16:01:29,423 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:01:29] "[36mGET /swaggerui/swagger-ui-bundle.js HTTP/1.1[0m" 304 -
2025-05-19 16:01:29,424 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:01:29] "[36mGET /swaggerui/swagger-ui-standalone-preset.js HTTP/1.1[0m" 304 -
2025-05-19 16:01:29,814 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:01:29] "GET /swagger.json HTTP/1.1" 200 -
2025-05-19 16:01:29,818 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:01:29] "[36mGET /swaggerui/favicon-32x32.png HTTP/1.1[0m" 304 -
2025-05-19 16:01:50,374 - app.services.travel_assistant - DEBUG - User ID: user123, Language: vi
2025-05-19 16:01:50,375 - app.services.travel_assistant - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 16:01:50,375 - app.services.travel_assistant - INFO - Getting recommendations from OpenAI...
2025-05-19 16:01:50,388 - openai - DEBUG - message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
2025-05-19 16:01:50,388 - openai - DEBUG - api_version=None data='{"model": "gpt-3.5-turbo", "messages": [{"role": "system", "content": "You are a helpful travel assistant that provides personalized travel recommendations."}, {"role": "user", "content": "\\n        Based on the following travel guide information and user query, provide a personalized travel recommendation:\\n        \\n        \\n        Travel Guide Information:\\n        Attractions: [{\\"name\\": \\"Ch\\u1ee3 B\\u1ebfn Th\\u00e0nh\\", \\"description\\": \\"Ch\\u1ee3 B\\u1ebfn Th\\u00e0nh l\\u00e0 m\\u1ed9t trong nh\\u1eefng bi\\u1ec3u t\\u01b0\\u1ee3ng c\\u1ee7a S\\u00e0i G\\u00f2n, n\\u01a1i b\\u1ea1n c\\u00f3 th\\u1ec3 mua s\\u1eafm v\\u00e0 th\\u01b0\\u1edfng th\\u1ee9c \\u1ea9m th\\u1ef1c \\u0111\\u1ecba ph\\u01b0\\u01a1ng.\\"}, {\\"name\\": \\"Nh\\u00e0 th\\u1edd \\u0110\\u1ee9c B\\u00e0\\", \\"description\\": \\"Nh\\u00e0 th\\u1edd \\u0110\\u1ee9c B\\u00e0 l\\u00e0 m\\u1ed9t c\\u00f4ng tr\\u00ecnh ki\\u1ebfn tr\\u00fac Ph\\u00e1p c\\u1ed5 k\\u00ednh, bi\\u1ec3u t\\u01b0\\u1ee3ng c\\u1ee7a S\\u00e0i G\\u00f2n.\\"}, {\\"name\\": \\"B\\u1ea3o t\\u00e0ng Ch\\u1ee9ng t\\u00edch Chi\\u1ebfn tranh\\", \\"description\\": \\"B\\u1ea3o t\\u00e0ng l\\u01b0u gi\\u1eef nh\\u1eefng hi\\u1ec7n v\\u1eadt v\\u00e0 t\\u00e0i li\\u1ec7u v\\u1ec1 chi\\u1ebfn tranh Vi\\u1ec7t Nam.\\"}]\\n        Cuisine: [{\\"name\\": \\"Ph\\u1edf\\", \\"description\\": \\"M\\u00f3n \\u0103n truy\\u1ec1n th\\u1ed1ng c\\u1ee7a Vi\\u1ec7t Nam v\\u1edbi n\\u01b0\\u1edbc d\\u00f9ng th\\u01a1m ngon.\\"}, {\\"name\\": \\"B\\u00e1nh m\\u00ec\\", \\"description\\": \\"B\\u00e1nh m\\u00ec Vi\\u1ec7t Nam v\\u1edbi nh\\u00e2n th\\u1ecbt v\\u00e0 rau t\\u01b0\\u01a1i.\\"}]\\n        Transportation: {\\"Xe bu\\u00fdt\\": \\"H\\u1ec7 th\\u1ed1ng xe bu\\u00fdt c\\u00f4ng c\\u1ed9ng ph\\u1ee7 kh\\u1eafp th\\u00e0nh ph\\u1ed1.\\", \\"Taxi\\": \\"Taxi v\\u00e0 Grab c\\u00f3 s\\u1eb5n 24/7.\\", \\"Xe m\\u00e1y\\": \\"Ph\\u01b0\\u01a1ng ti\\u1ec7n ph\\u1ed5 bi\\u1ebfn nh\\u1ea5t \\u0111\\u1ec3 di chuy\\u1ec3n trong th\\u00e0nh ph\\u1ed1.\\"}\\n        Accommodation: {\\"Qu\\u1eadn 1\\": \\"Khu v\\u1ef1c trung t\\u00e2m v\\u1edbi nhi\\u1ec1u kh\\u00e1ch s\\u1ea1n cao c\\u1ea5p.\\", \\"Qu\\u1eadn 3\\": \\"Khu v\\u1ef1c y\\u00ean t\\u0129nh v\\u1edbi nhi\\u1ec1u homestay.\\"}\\n        Weather: {\\"M\\u00f9a kh\\u00f4\\": \\"T\\u1eeb th\\u00e1ng 12 \\u0111\\u1ebfn th\\u00e1ng 4, th\\u1eddi ti\\u1ebft n\\u1eafng n\\u00f3ng.\\", \\"M\\u00f9a m\\u01b0a\\": \\"T\\u1eeb th\\u00e1ng 5 \\u0111\\u1ebfn th\\u00e1ng 11, m\\u01b0a nhi\\u1ec1u v\\u00e0o bu\\u1ed5i chi\\u1ec1u.\\"}\\n        Tips: [\\"N\\u00ean mang theo \\u00f4 ho\\u1eb7c \\u00e1o m\\u01b0a trong m\\u00f9a m\\u01b0a.\\", \\"C\\u1ea9n th\\u1eadn v\\u1edbi m\\u00f3c t\\u00fai \\u1edf c\\u00e1c khu v\\u1ef1c \\u0111\\u00f4ng ng\\u01b0\\u1eddi.\\", \\"N\\u00ean \\u0111\\u1ed5i ti\\u1ec1n t\\u1ea1i ng\\u00e2n h\\u00e0ng ho\\u1eb7c ti\\u1ec7m v\\u00e0ng.\\"]\\n        \\n        \\n        User Query: T\\u00f4i mu\\u1ed1n \\u0111i du l\\u1ecbch H\\u1ed3 Ch\\u00ed Minh 3 ng\\u00e0y, ng\\u00e2n s\\u00e1ch 5 tri\\u1ec7u\\n        \\n        Please provide a response in the following JSON format:\\n        {\\n            \\"itinerary\\": [\\n                {\\n                    \\"day\\": 1,\\n                    \\"activities\\": [\\n                        {\\n                            \\"time\\": \\"HH:MM\\",\\n                            \\"name\\": \\"Activity name\\",\\n                            \\"description\\": \\"Activity description\\",\\n                            \\"location\\": {\\n                                \\"name\\": \\"Location name\\",\\n                                \\"address\\": \\"Location address\\"\\n                            },\\n                            \\"estimated_cost\\": \\"Cost in VND\\"\\n                        }\\n                    ]\\n                }\\n            ],\\n            \\"total_cost\\": \\"Total estimated cost in VND\\",\\n            \\"transportation\\": \\"Recommended transportation methods\\",\\n            \\"tips\\": [\\"Important tips for the trip\\"]\\n        }\\n        "}], "temperature": 0.7}' message='Post details'
2025-05-19 16:01:50,389 - urllib3.util.retry - DEBUG - Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-05-19 16:01:50,461 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.openai.com:443
2025-05-19 16:01:58,951 - urllib3.connectionpool - DEBUG - https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
2025-05-19 16:01:58,957 - openai - DEBUG - message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=7675 request_id=req_bee78a0b0d927e254de22943df05da74 response_code=200
2025-05-19 16:01:58,959 - app.services.travel_assistant - INFO - Adding location coordinates...
2025-05-19 16:01:58,964 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:01:59,141 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Ch%E1%BB%A3%20B%E1%BA%BFn%20Th%C3%A0nh.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&language=vi HTTP/1.1" 200 None
2025-05-19 16:01:59,152 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:01:59,528 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Local%20Ph%E1%BB%9F%20Restaurant.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&language=vi HTTP/1.1" 200 None
2025-05-19 16:01:59,535 - app.services.travel_assistant - DEBUG - Found coordinates: {'id': 'address.8273384464688814', 'type': 'Feature', 'place_type': ['address'], 'relevance': 0.408889, 'properties': {'accuracy': 'street', 'mapbox_id': 'dXJuOm1ieGFkci1zdHI6ZmM1Y2U1N2EtNjY4NC00MjJhLTk4NzgtNzgzNjNlNWQ5NGVm'}, 'text_vi': 'Fazenda Restaurante Paineiras', 'place_name_vi': 'Fazenda Restaurante Paineiras, Campo Alegre de Goiás - Goiás, 75795-000, Brasil', 'text': 'Fazenda Restaurante Paineiras', 'place_name': 'Fazenda Restaurante Paineiras, Campo Alegre de Goiás - Goiás, 75795-000, Brasil', 'center': [-47.786644, -17.332628], 'geometry': {'type': 'Point', 'coordinates': [-47.786644, -17.332628]}, 'context': [{'id': 'postcode.8273384464688814', 'text_vi': '75795-000', 'text': '75795-000'}, {'id': 'place.7850016', 'mapbox_id': 'dXJuOm1ieHBsYzpkOGdn', 'wikidata': 'Q988803', 'text_vi': 'Campo Alegre de Goiás', 'language_vi': 'vi', 'text': 'Campo Alegre de Goiás', 'language': 'vi'}, {'id': 'region.140320', 'mapbox_id': 'dXJuOm1ieHBsYzpBaVFn', 'wikidata': 'Q41587', 'short_code': 'BR-GO', 'text_vi': 'Goiás', 'language_vi': 'vi', 'text': 'Goiás', 'language': 'vi'}, {'id': 'country.8736', 'mapbox_id': 'dXJuOm1ieHBsYzpJaUE', 'wikidata': 'Q155', 'short_code': 'br', 'text_vi': 'Brasil', 'language_vi': 'vi', 'text': 'Brasil', 'language': 'vi'}]}
2025-05-19 16:01:59,561 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:01:59,749 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Nh%C3%A0%20th%E1%BB%9D%20%C4%90%E1%BB%A9c%20B%C3%A0.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&language=vi HTTP/1.1" 200 None
2025-05-19 16:01:59,762 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:02:00,112 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/B%E1%BA%A3o%20t%C3%A0ng%20Ch%E1%BB%A9ng%20t%C3%ADch%20Chi%E1%BA%BFn%20tranh.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&language=vi HTTP/1.1" 200 None
2025-05-19 16:02:00,118 - app.services.travel_assistant - DEBUG - Searching coordinates for: Local Street Food Stall
2025-05-19 16:02:00,119 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:02:00,379 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Local%20Street%20Food%20Stall.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&language=vi HTTP/1.1" 200 None
2025-05-19 16:02:00,386 - app.services.travel_assistant - INFO - Generating map URL...
2025-05-19 16:02:00,386 - app.services.travel_assistant - ERROR - Error processing travel query: 1
Traceback (most recent call last):
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\app\services\travel_assistant.py", line 91, in process_travel_query
    'latitude': coords[1],
KeyError: 1
2025-05-19 16:02:00,387 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:02:00] "POST /api/travel/ask HTTP/1.1" 200 -
2025-05-19 16:33:56,204 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\travel_assistant.py', reloading
2025-05-19 16:34:00,715 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:34:00,723 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:34:00,728 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:34:00,846 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:34:00,846 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:37:52,172 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\routes\\travel_routes.py', reloading
2025-05-19 16:37:56,292 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:37:56,300 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:37:56,306 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:37:56,414 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:37:56,415 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:38:54,680 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\openai_service.py', reloading
2025-05-19 16:38:58,723 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:38:58,729 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:38:58,733 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:38:58,842 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:38:58,842 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:39:40,557 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\scraper.py', reloading
2025-05-19 16:39:44,446 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:39:44,452 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:39:44,456 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:39:44,573 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:39:44,573 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:40:03,812 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\mapbox_service.py', reloading
2025-05-19 16:40:08,479 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:40:08,486 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:40:08,491 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:40:08,615 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:40:08,615 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:42:12,379 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:42:12] "GET /docs HTTP/1.1" 200 -
2025-05-19 16:42:12,492 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:42:12] "[36mGET /swaggerui/droid-sans.css HTTP/1.1[0m" 304 -
2025-05-19 16:42:12,624 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:42:12] "[36mGET /swaggerui/swagger-ui.css HTTP/1.1[0m" 304 -
2025-05-19 16:42:12,747 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:42:12] "[36mGET /swaggerui/swagger-ui-bundle.js HTTP/1.1[0m" 304 -
2025-05-19 16:42:12,749 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:42:12] "[36mGET /swaggerui/swagger-ui-standalone-preset.js HTTP/1.1[0m" 304 -
2025-05-19 16:42:13,249 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:42:13] "GET /swagger.json HTTP/1.1" 200 -
2025-05-19 16:42:13,251 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:42:13] "[36mGET /swaggerui/favicon-32x32.png HTTP/1.1[0m" 304 -
2025-05-19 16:42:27,909 - app.routes.travel_routes - INFO - Received travel query request
2025-05-19 16:42:27,928 - app.routes.travel_routes - DEBUG - User ID: user123, Language: vi
2025-05-19 16:42:27,928 - app.routes.travel_routes - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 16:42:27,934 - app.services.travel_assistant - DEBUG - User ID: user123, Language: vi
2025-05-19 16:42:27,934 - app.services.travel_assistant - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 16:42:27,934 - app.services.travel_assistant - INFO - Getting recommendations from OpenAI...
2025-05-19 16:42:27,941 - app.services.openai_service - DEBUG - Preparing context from travel data
2025-05-19 16:42:27,941 - app.services.openai_service - ERROR - Error preparing context: string indices must be integers
Traceback (most recent call last):
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\app\services\openai_service.py", line 157, in _prepare_context
    context_parts.append(f"- {option['type']}: {option['description']}")
TypeError: string indices must be integers
2025-05-19 16:42:27,941 - app.services.openai_service - DEBUG - Prepared context length: 0
2025-05-19 16:42:27,942 - app.services.openai_service - DEBUG - Sending request to OpenAI API...
2025-05-19 16:42:27,954 - openai - DEBUG - message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
2025-05-19 16:42:27,955 - openai - DEBUG - api_version=None data='{"model": "gpt-3.5-turbo", "messages": [{"role": "system", "content": "You are a helpful travel assistant specializing in Ho Chi Minh City tourism."}, {"role": "user", "content": "Based on the following travel information about Ho Chi Minh City, please create a personalized travel itinerary.\\n\\nTravel Information:\\n\\n\\nUser Query: T\\u00f4i mu\\u1ed1n \\u0111i du l\\u1ecbch H\\u1ed3 Ch\\u00ed Minh 3 ng\\u00e0y v\\u1edbi ng\\u00e2n s\\u00e1ch 5 tri\\u1ec7u\\n\\nPlease provide a detailed response in the following JSON format:\\n{\\n    \\"itinerary\\": [\\n        {\\n            \\"day\\": 1,\\n            \\"activities\\": [\\n                {\\n                    \\"time\\": \\"HH:MM\\",\\n                    \\"name\\": \\"Activity name\\",\\n                    \\"description\\": \\"Detailed description\\",\\n                    \\"location\\": {\\n                        \\"name\\": \\"Location name\\",\\n                        \\"address\\": \\"Full address\\"\\n                    },\\n                    \\"estimated_cost\\": \\"Cost in VND\\"\\n                }\\n            ]\\n        }\\n    ],\\n    \\"tips\\": [\\n        \\"Tip 1\\",\\n        \\"Tip 2\\"\\n    ],\\n    \\"transportation\\": \\"Transportation advice\\",\\n    \\"total_cost\\": \\"Total estimated cost in VND\\"\\n}\\n\\nEnsure the itinerary is realistic, considering:\\n1. Opening hours of attractions\\n2. Travel time between locations\\n3. Local customs and culture\\n4. Weather conditions\\n5. Budget constraints\\n"}], "temperature": 0.7, "max_tokens": 2000}' message='Post details'
2025-05-19 16:42:27,955 - urllib3.util.retry - DEBUG - Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-05-19 16:42:28,037 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.openai.com:443
2025-05-19 16:42:36,439 - urllib3.connectionpool - DEBUG - https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
2025-05-19 16:42:36,441 - openai - DEBUG - message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=7462 request_id=req_9362d7d505657b73c50202c039f75509 response_code=200
2025-05-19 16:42:36,444 - app.services.openai_service - DEBUG - Received response from OpenAI: {
    "itinerary": [
        {
            "day": 1,
            "activities": [
                {
                    "time": "08:00",
                    "name": "Visit Ben Thanh Market",
          ...
2025-05-19 16:42:36,444 - app.services.openai_service - INFO - Successfully parsed OpenAI response
2025-05-19 16:42:36,444 - app.services.travel_assistant - INFO - Adding location coordinates...
2025-05-19 16:42:36,444 - app.services.travel_assistant - DEBUG - Searching coordinates for: Ben Thanh Market
2025-05-19 16:42:36,444 - app.services.mapbox_service - INFO - Searching for place: Ben Thanh Market
2025-05-19 16:42:36,444 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Ben Thanh Market.json
2025-05-19 16:42:36,446 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:36,907 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Ben%20Thanh%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:36,915 - app.services.mapbox_service - INFO - Found coordinates: [105.46456, 18.996002]
2025-05-19 16:42:36,917 - app.services.travel_assistant - DEBUG - Found coordinates: 105.46456
2025-05-19 16:42:36,917 - app.services.travel_assistant - DEBUG - Searching coordinates for: War Remnants Museum
2025-05-19 16:42:36,917 - app.services.mapbox_service - INFO - Searching for place: War Remnants Museum
2025-05-19 16:42:36,918 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/War Remnants Museum.json
2025-05-19 16:42:36,920 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:37,142 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/War%20Remnants%20Museum.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:37,143 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['war', 'remnants', 'museum'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:37,143 - app.services.mapbox_service - WARNING - No results found for: War Remnants Museum
2025-05-19 16:42:37,147 - app.services.travel_assistant - WARNING - No coordinates found for: War Remnants Museum
2025-05-19 16:42:37,148 - app.services.travel_assistant - DEBUG - Searching coordinates for: Notre Dame Cathedral and Central Post Office
2025-05-19 16:42:37,148 - app.services.mapbox_service - INFO - Searching for place: Notre Dame Cathedral and Central Post Office
2025-05-19 16:42:37,148 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Notre Dame Cathedral and Central Post Office.json
2025-05-19 16:42:37,150 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:37,537 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Notre%20Dame%20Cathedral%20and%20Central%20Post%20Office.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:37,539 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['notre', 'dame', 'cathedral', 'and', 'central', 'post', 'office'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:37,540 - app.services.mapbox_service - WARNING - No results found for: Notre Dame Cathedral and Central Post Office
2025-05-19 16:42:37,542 - app.services.travel_assistant - WARNING - No coordinates found for: Notre Dame Cathedral and Central Post Office
2025-05-19 16:42:37,543 - app.services.travel_assistant - DEBUG - Searching coordinates for: Nguyen Hue Walking Street
2025-05-19 16:42:37,544 - app.services.mapbox_service - INFO - Searching for place: Nguyen Hue Walking Street
2025-05-19 16:42:37,545 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Nguyen Hue Walking Street.json
2025-05-19 16:42:37,548 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:37,940 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Nguyen%20Hue%20Walking%20Street.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:37,946 - app.services.mapbox_service - INFO - Found coordinates: [107.594864, 16.463463]
2025-05-19 16:42:37,947 - app.services.travel_assistant - DEBUG - Found coordinates: 107.594864
2025-05-19 16:42:37,948 - app.services.travel_assistant - DEBUG - Searching coordinates for: Cu Chi Tunnels
2025-05-19 16:42:37,948 - app.services.mapbox_service - INFO - Searching for place: Cu Chi Tunnels
2025-05-19 16:42:37,948 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Cu Chi Tunnels.json
2025-05-19 16:42:37,950 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:38,217 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Cu%20Chi%20Tunnels.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:38,218 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['cu', 'chi', 'tunnels'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:38,218 - app.services.mapbox_service - WARNING - No results found for: Cu Chi Tunnels
2025-05-19 16:42:38,219 - app.services.travel_assistant - WARNING - No coordinates found for: Cu Chi Tunnels
2025-05-19 16:42:38,220 - app.services.travel_assistant - DEBUG - Searching coordinates for: Local Pho Restaurant
2025-05-19 16:42:38,220 - app.services.mapbox_service - INFO - Searching for place: Local Pho Restaurant
2025-05-19 16:42:38,220 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Local Pho Restaurant.json
2025-05-19 16:42:38,222 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:38,447 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Local%20Pho%20Restaurant.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:38,449 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['local', 'pho', 'restaurant'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:38,451 - app.services.mapbox_service - WARNING - No results found for: Local Pho Restaurant
2025-05-19 16:42:38,455 - app.services.travel_assistant - WARNING - No coordinates found for: Local Pho Restaurant
2025-05-19 16:42:38,456 - app.services.travel_assistant - DEBUG - Searching coordinates for: Bitexco Financial Tower
2025-05-19 16:42:38,457 - app.services.mapbox_service - INFO - Searching for place: Bitexco Financial Tower
2025-05-19 16:42:38,458 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Bitexco Financial Tower.json
2025-05-19 16:42:38,462 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:38,690 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Bitexco%20Financial%20Tower.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:38,692 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['bitexco', 'financial', 'tower'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:38,693 - app.services.mapbox_service - WARNING - No results found for: Bitexco Financial Tower
2025-05-19 16:42:38,698 - app.services.travel_assistant - WARNING - No coordinates found for: Bitexco Financial Tower
2025-05-19 16:42:38,699 - app.services.travel_assistant - DEBUG - Searching coordinates for: Local Street Food Market
2025-05-19 16:42:38,700 - app.services.mapbox_service - INFO - Searching for place: Local Street Food Market
2025-05-19 16:42:38,701 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Local Street Food Market.json
2025-05-19 16:42:38,707 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:38,941 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Local%20Street%20Food%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:38,942 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['local', 'street', 'food', 'market'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:38,943 - app.services.mapbox_service - WARNING - No results found for: Local Street Food Market
2025-05-19 16:42:38,944 - app.services.travel_assistant - WARNING - No coordinates found for: Local Street Food Market
2025-05-19 16:42:38,944 - app.services.travel_assistant - DEBUG - Searching coordinates for: Thao Cam Vien
2025-05-19 16:42:38,945 - app.services.mapbox_service - INFO - Searching for place: Thao Cam Vien
2025-05-19 16:42:38,945 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Thao Cam Vien.json
2025-05-19 16:42:38,946 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:39,175 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Thao%20Cam%20Vien.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:39,176 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['thao', 'cam', 'vien'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:39,176 - app.services.mapbox_service - WARNING - No results found for: Thao Cam Vien
2025-05-19 16:42:39,177 - app.services.travel_assistant - WARNING - No coordinates found for: Thao Cam Vien
2025-05-19 16:42:39,178 - app.services.travel_assistant - DEBUG - Searching coordinates for: Local Banh Mi Stall
2025-05-19 16:42:39,178 - app.services.mapbox_service - INFO - Searching for place: Local Banh Mi Stall
2025-05-19 16:42:39,178 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Local Banh Mi Stall.json
2025-05-19 16:42:39,180 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:39,471 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Local%20Banh%20Mi%20Stall.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:39,473 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['local', 'banh', 'mi', 'stall'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:39,475 - app.services.mapbox_service - WARNING - No results found for: Local Banh Mi Stall
2025-05-19 16:42:39,479 - app.services.travel_assistant - WARNING - No coordinates found for: Local Banh Mi Stall
2025-05-19 16:42:39,480 - app.services.travel_assistant - DEBUG - Searching coordinates for: Saigon Square
2025-05-19 16:42:39,481 - app.services.mapbox_service - INFO - Searching for place: Saigon Square
2025-05-19 16:42:39,482 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Saigon Square.json
2025-05-19 16:42:39,487 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:42:39,713 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Saigon%20Square.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace&limit=1 HTTP/1.1" 200 None
2025-05-19 16:42:39,714 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['saigon', 'square'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:42:39,714 - app.services.mapbox_service - WARNING - No results found for: Saigon Square
2025-05-19 16:42:39,715 - app.services.travel_assistant - WARNING - No coordinates found for: Saigon Square
2025-05-19 16:42:39,716 - app.services.travel_assistant - INFO - Generating map URL...
2025-05-19 16:42:39,717 - app.services.travel_assistant - ERROR - Error processing travel query: 'float' object is not subscriptable
Traceback (most recent call last):
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\app\services\travel_assistant.py", line 91, in process_travel_query
    'latitude': coords[1],
TypeError: 'float' object is not subscriptable
2025-05-19 16:42:39,717 - app.routes.travel_routes - ERROR - Error processing query: Failed to process query: 'float' object is not subscriptable
2025-05-19 16:42:39,717 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:42:39] "[35m[1mPOST /api/travel/ask HTTP/1.1[0m" 500 -
2025-05-19 16:45:59,359 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\mapbox_service.py', reloading
2025-05-19 16:46:03,909 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:46:03,919 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:46:03,926 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:46:04,084 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:46:04,084 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:46:30,038 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\travel_assistant.py', reloading
2025-05-19 16:46:34,877 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:46:34,884 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:46:34,888 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:46:35,010 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:46:35,010 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:48:44,940 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\travel_assistant.py', reloading
2025-05-19 16:48:48,851 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:48:48,857 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:48:48,861 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:48:48,970 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:48:48,970 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:49:55,686 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\mapbox_service.py', reloading
2025-05-19 16:49:59,891 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:49:59,898 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:49:59,911 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:50:00,021 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:50:00,022 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:50:16,837 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\travel_assistant.py', reloading
2025-05-19 16:50:21,067 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:50:21,073 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:50:21,077 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:50:21,186 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:50:21,187 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:50:45,387 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\services\\travel_assistant.py', reloading
2025-05-19 16:50:50,474 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:50:50,486 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:50:50,495 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:50:50,650 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:50:50,651 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:50:54,616 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:50:54] "GET /docs HTTP/1.1" 200 -
2025-05-19 16:50:54,816 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:50:54] "[36mGET /swaggerui/droid-sans.css HTTP/1.1[0m" 304 -
2025-05-19 16:50:54,875 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:50:54] "[36mGET /swaggerui/swagger-ui.css HTTP/1.1[0m" 304 -
2025-05-19 16:50:55,007 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:50:55] "[36mGET /swaggerui/swagger-ui-standalone-preset.js HTTP/1.1[0m" 304 -
2025-05-19 16:50:55,008 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:50:55] "[36mGET /swaggerui/swagger-ui-bundle.js HTTP/1.1[0m" 304 -
2025-05-19 16:50:55,455 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:50:55] "GET /swagger.json HTTP/1.1" 200 -
2025-05-19 16:50:55,457 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:50:55] "[36mGET /swaggerui/favicon-32x32.png HTTP/1.1[0m" 304 -
2025-05-19 16:51:04,204 - app.routes.travel_routes - INFO - Received travel query request
2025-05-19 16:51:04,216 - app.routes.travel_routes - DEBUG - User ID: user123, Language: vi
2025-05-19 16:51:04,217 - app.routes.travel_routes - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 16:51:04,221 - app.services.travel_assistant - DEBUG - User ID: user123, Language: vi
2025-05-19 16:51:04,221 - app.services.travel_assistant - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 16:51:04,222 - app.services.travel_assistant - INFO - Getting recommendations from OpenAI...
2025-05-19 16:51:04,225 - app.services.openai_service - DEBUG - Preparing context from travel data
2025-05-19 16:51:04,225 - app.services.openai_service - ERROR - Error preparing context: string indices must be integers
Traceback (most recent call last):
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\app\services\openai_service.py", line 157, in _prepare_context
    context_parts.append(f"- {option['type']}: {option['description']}")
TypeError: string indices must be integers
2025-05-19 16:51:04,226 - app.services.openai_service - DEBUG - Prepared context length: 0
2025-05-19 16:51:04,226 - app.services.openai_service - DEBUG - Sending request to OpenAI API...
2025-05-19 16:51:04,236 - openai - DEBUG - message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
2025-05-19 16:51:04,236 - openai - DEBUG - api_version=None data='{"model": "gpt-3.5-turbo", "messages": [{"role": "system", "content": "You are a helpful travel assistant specializing in Ho Chi Minh City tourism."}, {"role": "user", "content": "Based on the following travel information about Ho Chi Minh City, please create a personalized travel itinerary.\\n\\nTravel Information:\\n\\n\\nUser Query: T\\u00f4i mu\\u1ed1n \\u0111i du l\\u1ecbch H\\u1ed3 Ch\\u00ed Minh 3 ng\\u00e0y v\\u1edbi ng\\u00e2n s\\u00e1ch 5 tri\\u1ec7u\\n\\nPlease provide a detailed response in the following JSON format:\\n{\\n    \\"itinerary\\": [\\n        {\\n            \\"day\\": 1,\\n            \\"activities\\": [\\n                {\\n                    \\"time\\": \\"HH:MM\\",\\n                    \\"name\\": \\"Activity name\\",\\n                    \\"description\\": \\"Detailed description\\",\\n                    \\"location\\": {\\n                        \\"name\\": \\"Location name\\",\\n                        \\"address\\": \\"Full address\\"\\n                    },\\n                    \\"estimated_cost\\": \\"Cost in VND\\"\\n                }\\n            ]\\n        }\\n    ],\\n    \\"tips\\": [\\n        \\"Tip 1\\",\\n        \\"Tip 2\\"\\n    ],\\n    \\"transportation\\": \\"Transportation advice\\",\\n    \\"total_cost\\": \\"Total estimated cost in VND\\"\\n}\\n\\nEnsure the itinerary is realistic, considering:\\n1. Opening hours of attractions\\n2. Travel time between locations\\n3. Local customs and culture\\n4. Weather conditions\\n5. Budget constraints\\n"}], "temperature": 0.7, "max_tokens": 2000}' message='Post details'
2025-05-19 16:51:04,236 - urllib3.util.retry - DEBUG - Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-05-19 16:51:04,293 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.openai.com:443
2025-05-19 16:51:09,176 - urllib3.connectionpool - DEBUG - https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
2025-05-19 16:51:09,179 - openai - DEBUG - message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=4201 request_id=req_df9574742bed5b5c58926bdb3cd09d3e response_code=200
2025-05-19 16:51:09,181 - app.services.openai_service - DEBUG - Received response from OpenAI: {
    "itinerary": [
        {
            "day": 1,
            "activities": [
                {
                    "time": "08:00",
                    "name": "Visit Ben Thanh Market",
          ...
2025-05-19 16:51:09,181 - app.services.openai_service - INFO - Successfully parsed OpenAI response
2025-05-19 16:51:09,181 - app.services.travel_assistant - INFO - Adding location coordinates...
2025-05-19 16:51:09,182 - app.services.travel_assistant - DEBUG - Searching coordinates for: Ben Thanh Market
2025-05-19 16:51:09,182 - app.services.mapbox_service - INFO - Searching for place: Ben Thanh Market
2025-05-19 16:51:09,182 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Ben Thanh Market.json
2025-05-19 16:51:09,184 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:51:09,695 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Ben%20Thanh%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 16:51:09,701 - app.services.mapbox_service - INFO - Found coordinates: [106.617901, 10.9827]
2025-05-19 16:51:09,703 - app.services.travel_assistant - DEBUG - Found coordinates: (10.9827, 106.617901)
2025-05-19 16:51:09,703 - app.services.travel_assistant - DEBUG - Searching coordinates for: War Remnants Museum
2025-05-19 16:51:09,704 - app.services.mapbox_service - INFO - Searching for place: War Remnants Museum
2025-05-19 16:51:09,704 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/War Remnants Museum.json
2025-05-19 16:51:09,705 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:51:10,105 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/War%20Remnants%20Museum.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 16:51:10,107 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['war', 'remnants', 'museum'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 16:51:10,109 - app.services.mapbox_service - WARNING - No results found for: War Remnants Museum
2025-05-19 16:51:10,113 - app.services.travel_assistant - WARNING - No coordinates found for: War Remnants Museum
2025-05-19 16:51:10,114 - app.services.travel_assistant - DEBUG - Searching coordinates for: Notre-Dame Cathedral Basilica of Saigon
2025-05-19 16:51:10,115 - app.services.mapbox_service - INFO - Searching for place: Notre-Dame Cathedral Basilica of Saigon
2025-05-19 16:51:10,116 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Notre-Dame Cathedral Basilica of Saigon.json
2025-05-19 16:51:10,122 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:51:10,505 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Notre-Dame%20Cathedral%20Basilica%20of%20Saigon.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 16:51:10,524 - app.services.mapbox_service - INFO - Found coordinates: [106.704727, 10.768934]
2025-05-19 16:51:10,525 - app.services.travel_assistant - DEBUG - Found coordinates: (10.768934, 106.704727)
2025-05-19 16:51:10,525 - app.services.travel_assistant - DEBUG - Searching coordinates for: Nguyen Hue Walking Street
2025-05-19 16:51:10,525 - app.services.mapbox_service - INFO - Searching for place: Nguyen Hue Walking Street
2025-05-19 16:51:10,526 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Nguyen Hue Walking Street.json
2025-05-19 16:51:10,527 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 16:51:10,820 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Nguyen%20Hue%20Walking%20Street.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 16:51:10,827 - app.services.mapbox_service - INFO - Found coordinates: [106.703671, 10.773838]
2025-05-19 16:51:10,828 - app.services.travel_assistant - DEBUG - Found coordinates: (10.773838, 106.703671)
2025-05-19 16:51:10,828 - app.services.travel_assistant - INFO - Generating map URL...
2025-05-19 16:51:10,829 - app.services.mapbox_service - INFO - Generating static map URL...
2025-05-19 16:51:10,829 - app.services.mapbox_service - DEBUG - Center: (10.9827, 106.617901), Markers: [{'latitude': 10.9827, 'longitude': 106.617901, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.768934, 'longitude': 106.704727, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.773838, 'longitude': 106.703671, 'symbol': 'marker', 'color': 'ff0000'}]
2025-05-19 16:51:10,829 - app.services.mapbox_service - INFO - Static map URL generated successfully
2025-05-19 16:51:10,830 - app.services.travel_assistant - INFO - Map URL generated successfully
2025-05-19 16:51:10,830 - app.services.travel_assistant - INFO - Query processing completed successfully
2025-05-19 16:51:10,830 - app.routes.travel_routes - INFO - Query processed successfully
2025-05-19 16:51:10,831 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:51:10] "POST /api/travel/ask HTTP/1.1" 200 -
2025-05-19 16:53:20,567 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\main.py', reloading
2025-05-19 16:53:25,955 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 16:53:25,965 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 16:53:25,972 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 16:53:26,111 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 16:53:26,112 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 16:54:36,774 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:54:36] "GET /docs HTTP/1.1" 200 -
2025-05-19 16:54:36,893 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:54:36] "[36mGET /swaggerui/droid-sans.css HTTP/1.1[0m" 304 -
2025-05-19 16:54:37,031 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:54:37] "[36mGET /swaggerui/swagger-ui.css HTTP/1.1[0m" 304 -
2025-05-19 16:54:37,132 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:54:37] "[36mGET /swaggerui/swagger-ui-standalone-preset.js HTTP/1.1[0m" 304 -
2025-05-19 16:54:37,133 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:54:37] "[36mGET /swaggerui/swagger-ui-bundle.js HTTP/1.1[0m" 304 -
2025-05-19 16:54:37,547 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:54:37] "GET /swagger.json HTTP/1.1" 200 -
2025-05-19 16:54:37,550 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 16:54:37] "[36mGET /swaggerui/favicon-32x32.png HTTP/1.1[0m" 304 -
2025-05-19 17:12:20,811 - __main__ - ERROR - Unhandled error: 404 Not Found: The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.
Traceback (most recent call last):
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\venv\lib\site-packages\flask\app.py", line 1513, in full_dispatch_request
    rv = self.dispatch_request()
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\venv\lib\site-packages\flask\app.py", line 1499, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**req.view_args)
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\venv\lib\site-packages\flask_restx\api.py", line 446, in render_root
    self.abort(HTTPStatus.NOT_FOUND)
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\venv\lib\site-packages\flask_restx\namespace.py", line 157, in abort
    abort(*args, **kwargs)
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\venv\lib\site-packages\flask_restx\errors.py", line 31, in abort
    flask.abort(code)
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\venv\lib\site-packages\werkzeug\exceptions.py", line 940, in abort
    _aborter(status, *args, **kwargs)
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\venv\lib\site-packages\werkzeug\exceptions.py", line 923, in __call__
    raise self.mapping[code](*args, **kwargs)
werkzeug.exceptions.NotFound: 404 Not Found: The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.
2025-05-19 17:12:20,821 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:12:20] "[35m[1mGET / HTTP/1.1[0m" 500 -
2025-05-19 17:14:06,619 - werkzeug - INFO -  * Detected change in 'D:\\HOCKY8\\DO_AN_TOT_NGHIEP\\dev\\ScapeData\\model_cursor\\app\\main.py', reloading
2025-05-19 17:14:11,417 - __main__ - INFO - Starting Travel Assistant API...
2025-05-19 17:14:11,427 - werkzeug - WARNING -  * Debugger is active!
2025-05-19 17:14:11,435 - werkzeug - INFO -  * Debugger PIN: 949-176-252
2025-05-19 17:14:11,590 - werkzeug - WARNING -  * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
2025-05-19 17:14:11,590 - werkzeug - INFO -  * Running on http://192.168.226.197:5000/ (Press CTRL+C to quit)
2025-05-19 17:15:40,488 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:15:40] "OPTIONS /api/travel/ask HTTP/1.1" 200 -
2025-05-19 17:15:40,751 - app.routes.travel_routes - INFO - Received travel query request
2025-05-19 17:15:40,768 - app.routes.travel_routes - DEBUG - User ID: user123, Language: vi
2025-05-19 17:15:40,769 - app.routes.travel_routes - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 17:15:40,774 - app.services.travel_assistant - DEBUG - User ID: user123, Language: vi
2025-05-19 17:15:40,774 - app.services.travel_assistant - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 17:15:40,774 - app.services.travel_assistant - INFO - Getting recommendations from OpenAI...
2025-05-19 17:15:40,779 - app.services.openai_service - DEBUG - Preparing context from travel data
2025-05-19 17:15:40,779 - app.services.openai_service - ERROR - Error preparing context: string indices must be integers
Traceback (most recent call last):
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\app\services\openai_service.py", line 157, in _prepare_context
    context_parts.append(f"- {option['type']}: {option['description']}")
TypeError: string indices must be integers
2025-05-19 17:15:40,779 - app.services.openai_service - DEBUG - Prepared context length: 0
2025-05-19 17:15:40,780 - app.services.openai_service - DEBUG - Sending request to OpenAI API...
2025-05-19 17:15:40,791 - openai - DEBUG - message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
2025-05-19 17:15:40,791 - openai - DEBUG - api_version=None data='{"model": "gpt-3.5-turbo", "messages": [{"role": "system", "content": "You are a helpful travel assistant specializing in Ho Chi Minh City tourism."}, {"role": "user", "content": "Based on the following travel information about Ho Chi Minh City, please create a personalized travel itinerary.\\n\\nTravel Information:\\n\\n\\nUser Query: T\\u00f4i mu\\u1ed1n \\u0111i du l\\u1ecbch H\\u1ed3 Ch\\u00ed Minh 3 ng\\u00e0y v\\u1edbi ng\\u00e2n s\\u00e1ch 5 tri\\u1ec7u\\n\\nPlease provide a detailed response in the following JSON format:\\n{\\n    \\"itinerary\\": [\\n        {\\n            \\"day\\": 1,\\n            \\"activities\\": [\\n                {\\n                    \\"time\\": \\"HH:MM\\",\\n                    \\"name\\": \\"Activity name\\",\\n                    \\"description\\": \\"Detailed description\\",\\n                    \\"location\\": {\\n                        \\"name\\": \\"Location name\\",\\n                        \\"address\\": \\"Full address\\"\\n                    },\\n                    \\"estimated_cost\\": \\"Cost in VND\\"\\n                }\\n            ]\\n        }\\n    ],\\n    \\"tips\\": [\\n        \\"Tip 1\\",\\n        \\"Tip 2\\"\\n    ],\\n    \\"transportation\\": \\"Transportation advice\\",\\n    \\"total_cost\\": \\"Total estimated cost in VND\\"\\n}\\n\\nEnsure the itinerary is realistic, considering:\\n1. Opening hours of attractions\\n2. Travel time between locations\\n3. Local customs and culture\\n4. Weather conditions\\n5. Budget constraints\\n"}], "temperature": 0.7, "max_tokens": 2000}' message='Post details'
2025-05-19 17:15:40,791 - urllib3.util.retry - DEBUG - Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-05-19 17:15:40,793 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.openai.com:443
2025-05-19 17:15:53,050 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:15:53] "GET /docs HTTP/1.1" 200 -
2025-05-19 17:15:53,168 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:15:53] "[36mGET /swaggerui/droid-sans.css HTTP/1.1[0m" 304 -
2025-05-19 17:15:53,253 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:15:53] "[36mGET /swaggerui/swagger-ui.css HTTP/1.1[0m" 304 -
2025-05-19 17:15:53,418 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:15:53] "[36mGET /swaggerui/swagger-ui-bundle.js HTTP/1.1[0m" 304 -
2025-05-19 17:15:53,420 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:15:53] "[36mGET /swaggerui/swagger-ui-standalone-preset.js HTTP/1.1[0m" 304 -
2025-05-19 17:15:53,812 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:15:53] "GET /swagger.json HTTP/1.1" 200 -
2025-05-19 17:15:53,815 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:15:53] "[36mGET /swaggerui/favicon-32x32.png HTTP/1.1[0m" 304 -
2025-05-19 17:16:00,181 - urllib3.connectionpool - DEBUG - https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
2025-05-19 17:16:00,185 - openai - DEBUG - message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=18447 request_id=req_6805e151e1c61a0b7a1ccb16708ba0c3 response_code=200
2025-05-19 17:16:00,193 - app.services.openai_service - DEBUG - Received response from OpenAI: {
    "itinerary": [
        {
            "day": 1,
            "activities": [
                {
                    "time": "08:00",
                    "name": "Visit Ben Thanh Market",
          ...
2025-05-19 17:16:00,195 - app.services.openai_service - INFO - Successfully parsed OpenAI response
2025-05-19 17:16:00,196 - app.services.travel_assistant - INFO - Adding location coordinates...
2025-05-19 17:16:00,197 - app.services.travel_assistant - DEBUG - Searching coordinates for: Ben Thanh Market
2025-05-19 17:16:00,198 - app.services.mapbox_service - INFO - Searching for place: Ben Thanh Market
2025-05-19 17:16:00,200 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Ben Thanh Market.json
2025-05-19 17:16:00,206 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:00,478 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Ben%20Thanh%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:00,487 - app.services.mapbox_service - INFO - Found coordinates: [106.617901, 10.9827]
2025-05-19 17:16:00,488 - app.services.travel_assistant - DEBUG - Found coordinates: (10.9827, 106.617901)
2025-05-19 17:16:00,489 - app.services.travel_assistant - DEBUG - Searching coordinates for: War Remnants Museum
2025-05-19 17:16:00,489 - app.services.mapbox_service - INFO - Searching for place: War Remnants Museum
2025-05-19 17:16:00,489 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/War Remnants Museum.json
2025-05-19 17:16:00,491 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:00,732 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/War%20Remnants%20Museum.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:00,734 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['war', 'remnants', 'museum'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:16:00,734 - app.services.mapbox_service - WARNING - No results found for: War Remnants Museum
2025-05-19 17:16:00,736 - app.services.travel_assistant - WARNING - No coordinates found for: War Remnants Museum
2025-05-19 17:16:00,738 - app.services.travel_assistant - DEBUG - Searching coordinates for: Pho 2000
2025-05-19 17:16:00,739 - app.services.mapbox_service - INFO - Searching for place: Pho 2000
2025-05-19 17:16:00,739 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Pho 2000.json
2025-05-19 17:16:00,745 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:01,075 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Pho%202000.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:01,076 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['pho', '2000'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:16:01,076 - app.services.mapbox_service - WARNING - No results found for: Pho 2000
2025-05-19 17:16:01,078 - app.services.travel_assistant - WARNING - No coordinates found for: Pho 2000
2025-05-19 17:16:01,079 - app.services.travel_assistant - DEBUG - Searching coordinates for: Saigon Notre-Dame Cathedral
2025-05-19 17:16:01,079 - app.services.mapbox_service - INFO - Searching for place: Saigon Notre-Dame Cathedral
2025-05-19 17:16:01,079 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Saigon Notre-Dame Cathedral.json
2025-05-19 17:16:01,081 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:01,321 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Saigon%20Notre-Dame%20Cathedral.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:01,323 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['saigon', 'notre', 'dame', 'cathedral'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:16:01,325 - app.services.mapbox_service - WARNING - No results found for: Saigon Notre-Dame Cathedral
2025-05-19 17:16:01,328 - app.services.travel_assistant - WARNING - No coordinates found for: Saigon Notre-Dame Cathedral
2025-05-19 17:16:01,329 - app.services.travel_assistant - DEBUG - Searching coordinates for: Nguyen Hue Walking Street
2025-05-19 17:16:01,330 - app.services.mapbox_service - INFO - Searching for place: Nguyen Hue Walking Street
2025-05-19 17:16:01,330 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Nguyen Hue Walking Street.json
2025-05-19 17:16:01,334 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:01,561 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Nguyen%20Hue%20Walking%20Street.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:01,568 - app.services.mapbox_service - INFO - Found coordinates: [106.703671, 10.773838]
2025-05-19 17:16:01,570 - app.services.travel_assistant - DEBUG - Found coordinates: (10.773838, 106.703671)
2025-05-19 17:16:01,570 - app.services.travel_assistant - DEBUG - Searching coordinates for: Cu Chi Tunnels
2025-05-19 17:16:01,570 - app.services.mapbox_service - INFO - Searching for place: Cu Chi Tunnels
2025-05-19 17:16:01,570 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Cu Chi Tunnels.json
2025-05-19 17:16:01,572 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:01,801 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Cu%20Chi%20Tunnels.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:01,816 - app.services.mapbox_service - INFO - Found coordinates: [109.199535, 12.279861]
2025-05-19 17:16:01,820 - app.services.travel_assistant - DEBUG - Found coordinates: (12.279861, 109.199535)
2025-05-19 17:16:01,820 - app.services.travel_assistant - DEBUG - Searching coordinates for: Local Eatery
2025-05-19 17:16:01,820 - app.services.mapbox_service - INFO - Searching for place: Local Eatery
2025-05-19 17:16:01,821 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Local Eatery.json
2025-05-19 17:16:01,824 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:02,258 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Local%20Eatery.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:02,259 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['local', 'eatery'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:16:02,260 - app.services.mapbox_service - WARNING - No results found for: Local Eatery
2025-05-19 17:16:02,261 - app.services.travel_assistant - WARNING - No coordinates found for: Local Eatery
2025-05-19 17:16:02,261 - app.services.travel_assistant - DEBUG - Searching coordinates for: Binh Tay Market
2025-05-19 17:16:02,261 - app.services.mapbox_service - INFO - Searching for place: Binh Tay Market
2025-05-19 17:16:02,262 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Binh Tay Market.json
2025-05-19 17:16:02,263 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:02,578 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Binh%20Tay%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:02,585 - app.services.mapbox_service - INFO - Found coordinates: [106.652101, 10.745192]
2025-05-19 17:16:02,586 - app.services.travel_assistant - DEBUG - Found coordinates: (10.745192, 106.652101)
2025-05-19 17:16:02,586 - app.services.travel_assistant - DEBUG - Searching coordinates for: Turtle Lake
2025-05-19 17:16:02,586 - app.services.mapbox_service - INFO - Searching for place: Turtle Lake
2025-05-19 17:16:02,587 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Turtle Lake.json
2025-05-19 17:16:02,588 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:02,902 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Turtle%20Lake.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:02,908 - app.services.mapbox_service - INFO - Found coordinates: [105.793427, 21.079432]
2025-05-19 17:16:02,910 - app.services.travel_assistant - DEBUG - Found coordinates: (21.079432, 105.793427)
2025-05-19 17:16:02,910 - app.services.travel_assistant - DEBUG - Searching coordinates for: Independence Palace
2025-05-19 17:16:02,911 - app.services.mapbox_service - INFO - Searching for place: Independence Palace
2025-05-19 17:16:02,911 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Independence Palace.json
2025-05-19 17:16:02,912 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:03,149 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Independence%20Palace.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:03,150 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['independence', 'palace'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:16:03,150 - app.services.mapbox_service - WARNING - No results found for: Independence Palace
2025-05-19 17:16:03,152 - app.services.travel_assistant - WARNING - No coordinates found for: Independence Palace
2025-05-19 17:16:03,152 - app.services.travel_assistant - DEBUG - Searching coordinates for: Saigon Square
2025-05-19 17:16:03,153 - app.services.mapbox_service - INFO - Searching for place: Saigon Square
2025-05-19 17:16:03,153 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Saigon Square.json
2025-05-19 17:16:03,155 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:03,401 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Saigon%20Square.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:03,403 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['saigon', 'square'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:16:03,403 - app.services.mapbox_service - WARNING - No results found for: Saigon Square
2025-05-19 17:16:03,404 - app.services.travel_assistant - WARNING - No coordinates found for: Saigon Square
2025-05-19 17:16:03,405 - app.services.travel_assistant - DEBUG - Searching coordinates for: Banh Mi Huynh Hoa
2025-05-19 17:16:03,405 - app.services.mapbox_service - INFO - Searching for place: Banh Mi Huynh Hoa
2025-05-19 17:16:03,405 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Banh Mi Huynh Hoa.json
2025-05-19 17:16:03,407 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:03,668 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Banh%20Mi%20Huynh%20Hoa.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:03,674 - app.services.mapbox_service - INFO - Found coordinates: [106.417498, 10.51537]
2025-05-19 17:16:03,675 - app.services.travel_assistant - DEBUG - Found coordinates: (10.51537, 106.417498)
2025-05-19 17:16:03,675 - app.services.travel_assistant - DEBUG - Searching coordinates for: Ben Thanh Street Food Market
2025-05-19 17:16:03,675 - app.services.mapbox_service - INFO - Searching for place: Ben Thanh Street Food Market
2025-05-19 17:16:03,675 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Ben Thanh Street Food Market.json
2025-05-19 17:16:03,677 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:16:04,138 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Ben%20Thanh%20Street%20Food%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:16:04,150 - app.services.mapbox_service - INFO - Found coordinates: [107.451301, 10.864911]
2025-05-19 17:16:04,153 - app.services.travel_assistant - DEBUG - Found coordinates: (10.864911, 107.451301)
2025-05-19 17:16:04,154 - app.services.travel_assistant - INFO - Generating map URL...
2025-05-19 17:16:04,155 - app.services.mapbox_service - INFO - Generating static map URL...
2025-05-19 17:16:04,156 - app.services.mapbox_service - DEBUG - Center: (10.9827, 106.617901), Markers: [{'latitude': 10.9827, 'longitude': 106.617901, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.773838, 'longitude': 106.703671, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 12.279861, 'longitude': 109.199535, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.745192, 'longitude': 106.652101, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 21.079432, 'longitude': 105.793427, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.51537, 'longitude': 106.417498, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.864911, 'longitude': 107.451301, 'symbol': 'marker', 'color': 'ff0000'}]
2025-05-19 17:16:04,156 - app.services.mapbox_service - INFO - Static map URL generated successfully
2025-05-19 17:16:04,157 - app.services.travel_assistant - INFO - Map URL generated successfully
2025-05-19 17:16:04,158 - app.services.travel_assistant - INFO - Query processing completed successfully
2025-05-19 17:16:04,159 - app.routes.travel_routes - INFO - Query processed successfully
2025-05-19 17:16:04,162 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:16:04] "POST /api/travel/ask HTTP/1.1" 200 -
2025-05-19 17:18:01,702 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:18:01] "OPTIONS /api/travel/ask HTTP/1.1" 200 -
2025-05-19 17:18:01,969 - app.routes.travel_routes - INFO - Received travel query request
2025-05-19 17:18:01,978 - app.routes.travel_routes - DEBUG - User ID: user123, Language: vi
2025-05-19 17:18:01,978 - app.routes.travel_routes - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 17:18:01,983 - app.services.travel_assistant - DEBUG - User ID: user123, Language: vi
2025-05-19 17:18:01,983 - app.services.travel_assistant - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 17:18:01,983 - app.services.travel_assistant - INFO - Getting recommendations from OpenAI...
2025-05-19 17:18:01,987 - app.services.openai_service - DEBUG - Preparing context from travel data
2025-05-19 17:18:01,987 - app.services.openai_service - ERROR - Error preparing context: string indices must be integers
Traceback (most recent call last):
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\app\services\openai_service.py", line 157, in _prepare_context
    context_parts.append(f"- {option['type']}: {option['description']}")
TypeError: string indices must be integers
2025-05-19 17:18:01,988 - app.services.openai_service - DEBUG - Prepared context length: 0
2025-05-19 17:18:01,988 - app.services.openai_service - DEBUG - Sending request to OpenAI API...
2025-05-19 17:18:01,988 - openai - DEBUG - message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
2025-05-19 17:18:01,988 - openai - DEBUG - api_version=None data='{"model": "gpt-3.5-turbo", "messages": [{"role": "system", "content": "You are a helpful travel assistant specializing in Ho Chi Minh City tourism."}, {"role": "user", "content": "Based on the following travel information about Ho Chi Minh City, please create a personalized travel itinerary.\\n\\nTravel Information:\\n\\n\\nUser Query: T\\u00f4i mu\\u1ed1n \\u0111i du l\\u1ecbch th\\u00e0nh ph\\u1ed1 H\\u1ed3 Ch\\u00ed Minh 3 ng\\u00e0y v\\u1edbi ng\\u00e2n s\\u00e1ch 5 tri\\u1ec7u, t\\u00f4i mu\\u1ed1n kh\\u00e1m ph\\u00e1 \\u1ea9m th\\u1ef1c\\n\\nPlease provide a detailed response in the following JSON format:\\n{\\n    \\"itinerary\\": [\\n        {\\n            \\"day\\": 1,\\n            \\"activities\\": [\\n                {\\n                    \\"time\\": \\"HH:MM\\",\\n                    \\"name\\": \\"Activity name\\",\\n                    \\"description\\": \\"Detailed description\\",\\n                    \\"location\\": {\\n                        \\"name\\": \\"Location name\\",\\n                        \\"address\\": \\"Full address\\"\\n                    },\\n                    \\"estimated_cost\\": \\"Cost in VND\\"\\n                }\\n            ]\\n        }\\n    ],\\n    \\"tips\\": [\\n        \\"Tip 1\\",\\n        \\"Tip 2\\"\\n    ],\\n    \\"transportation\\": \\"Transportation advice\\",\\n    \\"total_cost\\": \\"Total estimated cost in VND\\"\\n}\\n\\nEnsure the itinerary is realistic, considering:\\n1. Opening hours of attractions\\n2. Travel time between locations\\n3. Local customs and culture\\n4. Weather conditions\\n5. Budget constraints\\n"}], "temperature": 0.7, "max_tokens": 2000}' message='Post details'
2025-05-19 17:18:01,989 - urllib3.util.retry - DEBUG - Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-05-19 17:18:01,990 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.openai.com:443
2025-05-19 17:18:10,772 - urllib3.connectionpool - DEBUG - https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
2025-05-19 17:18:10,776 - openai - DEBUG - message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=8247 request_id=req_79a257d110558deb38b5efb9075e8954 response_code=200
2025-05-19 17:18:10,778 - app.services.openai_service - DEBUG - Received response from OpenAI: {
    "itinerary": [
        {
            "day": 1,
            "activities": [
                {
                    "time": "08:00",
                    "name": "Visit Ben Thanh Market",
          ...
2025-05-19 17:18:10,779 - app.services.openai_service - INFO - Successfully parsed OpenAI response
2025-05-19 17:18:10,780 - app.services.travel_assistant - INFO - Adding location coordinates...
2025-05-19 17:18:10,781 - app.services.travel_assistant - DEBUG - Searching coordinates for: Ben Thanh Market
2025-05-19 17:18:10,782 - app.services.mapbox_service - INFO - Searching for place: Ben Thanh Market
2025-05-19 17:18:10,783 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Ben Thanh Market.json
2025-05-19 17:18:10,789 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:10,986 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Ben%20Thanh%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:10,998 - app.services.mapbox_service - INFO - Found coordinates: [106.617901, 10.9827]
2025-05-19 17:18:11,000 - app.services.travel_assistant - DEBUG - Found coordinates: (10.9827, 106.617901)
2025-05-19 17:18:11,001 - app.services.travel_assistant - DEBUG - Searching coordinates for: Pho Phuong
2025-05-19 17:18:11,001 - app.services.mapbox_service - INFO - Searching for place: Pho Phuong
2025-05-19 17:18:11,001 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Pho Phuong.json
2025-05-19 17:18:11,003 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:11,267 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Pho%20Phuong.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:11,273 - app.services.mapbox_service - INFO - Found coordinates: [106.724728, 21.022371]
2025-05-19 17:18:11,275 - app.services.travel_assistant - DEBUG - Found coordinates: (21.022371, 106.724728)
2025-05-19 17:18:11,275 - app.services.travel_assistant - DEBUG - Searching coordinates for: Saigon Cooking Class
2025-05-19 17:18:11,275 - app.services.mapbox_service - INFO - Searching for place: Saigon Cooking Class
2025-05-19 17:18:11,276 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Saigon Cooking Class.json
2025-05-19 17:18:11,277 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:11,510 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Saigon%20Cooking%20Class.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:11,511 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['saigon', 'cooking', 'class'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:18:11,512 - app.services.mapbox_service - WARNING - No results found for: Saigon Cooking Class
2025-05-19 17:18:11,513 - app.services.travel_assistant - WARNING - No coordinates found for: Saigon Cooking Class
2025-05-19 17:18:11,513 - app.services.travel_assistant - DEBUG - Searching coordinates for: Secret Garden Restaurant
2025-05-19 17:18:11,513 - app.services.mapbox_service - INFO - Searching for place: Secret Garden Restaurant
2025-05-19 17:18:11,514 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Secret Garden Restaurant.json
2025-05-19 17:18:11,515 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:11,790 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Secret%20Garden%20Restaurant.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:11,791 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['secret', 'garden', 'restaurant'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:18:11,791 - app.services.mapbox_service - WARNING - No results found for: Secret Garden Restaurant
2025-05-19 17:18:11,793 - app.services.travel_assistant - WARNING - No coordinates found for: Secret Garden Restaurant
2025-05-19 17:18:11,794 - app.services.travel_assistant - DEBUG - Searching coordinates for: War Remnants Museum
2025-05-19 17:18:11,794 - app.services.mapbox_service - INFO - Searching for place: War Remnants Museum
2025-05-19 17:18:11,794 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/War Remnants Museum.json
2025-05-19 17:18:11,796 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:11,987 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/War%20Remnants%20Museum.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:11,988 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['war', 'remnants', 'museum'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:18:11,990 - app.services.mapbox_service - WARNING - No results found for: War Remnants Museum
2025-05-19 17:18:11,995 - app.services.travel_assistant - WARNING - No coordinates found for: War Remnants Museum
2025-05-19 17:18:11,995 - app.services.travel_assistant - DEBUG - Searching coordinates for: Nha Hang Ngon
2025-05-19 17:18:11,997 - app.services.mapbox_service - INFO - Searching for place: Nha Hang Ngon
2025-05-19 17:18:11,997 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Nha Hang Ngon.json
2025-05-19 17:18:11,999 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:12,237 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Nha%20Hang%20Ngon.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:12,248 - app.services.mapbox_service - INFO - Found coordinates: [105.753809, 9.97425]
2025-05-19 17:18:12,249 - app.services.travel_assistant - DEBUG - Found coordinates: (9.97425, 105.753809)
2025-05-19 17:18:12,250 - app.services.travel_assistant - DEBUG - Searching coordinates for: Notre-Dame Cathedral Basilica of Saigon
2025-05-19 17:18:12,250 - app.services.mapbox_service - INFO - Searching for place: Notre-Dame Cathedral Basilica of Saigon
2025-05-19 17:18:12,250 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Notre-Dame Cathedral Basilica of Saigon.json
2025-05-19 17:18:12,252 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:12,535 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Notre-Dame%20Cathedral%20Basilica%20of%20Saigon.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:12,560 - app.services.mapbox_service - INFO - Found coordinates: [106.704727, 10.768934]
2025-05-19 17:18:12,564 - app.services.travel_assistant - DEBUG - Found coordinates: (10.768934, 106.704727)
2025-05-19 17:18:12,564 - app.services.travel_assistant - DEBUG - Searching coordinates for: Cuc Gach Quan
2025-05-19 17:18:12,565 - app.services.mapbox_service - INFO - Searching for place: Cuc Gach Quan
2025-05-19 17:18:12,566 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Cuc Gach Quan.json
2025-05-19 17:18:12,569 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:12,813 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Cuc%20Gach%20Quan.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:12,818 - app.services.mapbox_service - INFO - Found coordinates: [106.684495, 10.887706]
2025-05-19 17:18:12,820 - app.services.travel_assistant - DEBUG - Found coordinates: (10.887706, 106.684495)
2025-05-19 17:18:12,820 - app.services.travel_assistant - DEBUG - Searching coordinates for: Tao Dan Park
2025-05-19 17:18:12,820 - app.services.mapbox_service - INFO - Searching for place: Tao Dan Park
2025-05-19 17:18:12,820 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Tao Dan Park.json
2025-05-19 17:18:12,821 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:13,084 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Tao%20Dan%20Park.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:13,086 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['tao', 'dan', 'park'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:18:13,087 - app.services.mapbox_service - WARNING - No results found for: Tao Dan Park
2025-05-19 17:18:13,089 - app.services.travel_assistant - WARNING - No coordinates found for: Tao Dan Park
2025-05-19 17:18:13,090 - app.services.travel_assistant - DEBUG - Searching coordinates for: The Independence Palace
2025-05-19 17:18:13,090 - app.services.mapbox_service - INFO - Searching for place: The Independence Palace
2025-05-19 17:18:13,091 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/The Independence Palace.json
2025-05-19 17:18:13,094 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:13,336 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/The%20Independence%20Palace.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:13,337 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['the', 'independence', 'palace'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:18:13,338 - app.services.mapbox_service - WARNING - No results found for: The Independence Palace
2025-05-19 17:18:13,339 - app.services.travel_assistant - WARNING - No coordinates found for: The Independence Palace
2025-05-19 17:18:13,339 - app.services.travel_assistant - DEBUG - Searching coordinates for: Bun Cha 145
2025-05-19 17:18:13,340 - app.services.mapbox_service - INFO - Searching for place: Bun Cha 145
2025-05-19 17:18:13,340 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Bun Cha 145.json
2025-05-19 17:18:13,341 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:13,580 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Bun%20Cha%20145.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:13,581 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['bun', 'cha', '145'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:18:13,582 - app.services.mapbox_service - WARNING - No results found for: Bun Cha 145
2025-05-19 17:18:13,583 - app.services.travel_assistant - WARNING - No coordinates found for: Bun Cha 145
2025-05-19 17:18:13,584 - app.services.travel_assistant - DEBUG - Searching coordinates for: Saigon Square
2025-05-19 17:18:13,584 - app.services.mapbox_service - INFO - Searching for place: Saigon Square
2025-05-19 17:18:13,584 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Saigon Square.json
2025-05-19 17:18:13,586 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:18:13,810 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Saigon%20Square.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:18:13,812 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['saigon', 'square'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:18:13,812 - app.services.mapbox_service - WARNING - No results found for: Saigon Square
2025-05-19 17:18:13,813 - app.services.travel_assistant - WARNING - No coordinates found for: Saigon Square
2025-05-19 17:18:13,816 - app.services.travel_assistant - INFO - Generating map URL...
2025-05-19 17:18:13,816 - app.services.mapbox_service - INFO - Generating static map URL...
2025-05-19 17:18:13,816 - app.services.mapbox_service - DEBUG - Center: (10.9827, 106.617901), Markers: [{'latitude': 10.9827, 'longitude': 106.617901, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 21.022371, 'longitude': 106.724728, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 9.97425, 'longitude': 105.753809, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.768934, 'longitude': 106.704727, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.887706, 'longitude': 106.684495, 'symbol': 'marker', 'color': 'ff0000'}]
2025-05-19 17:18:13,816 - app.services.mapbox_service - INFO - Static map URL generated successfully
2025-05-19 17:18:13,818 - app.services.travel_assistant - INFO - Map URL generated successfully
2025-05-19 17:18:13,818 - app.services.travel_assistant - INFO - Query processing completed successfully
2025-05-19 17:18:13,818 - app.routes.travel_routes - INFO - Query processed successfully
2025-05-19 17:18:13,818 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:18:13] "POST /api/travel/ask HTTP/1.1" 200 -
2025-05-19 17:32:19,604 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:32:19] "OPTIONS /api/travel/ask HTTP/1.1" 200 -
2025-05-19 17:32:19,868 - app.routes.travel_routes - INFO - Received travel query request
2025-05-19 17:32:19,878 - app.routes.travel_routes - DEBUG - User ID: user123, Language: vi
2025-05-19 17:32:19,879 - app.routes.travel_routes - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 17:32:19,883 - app.services.travel_assistant - DEBUG - User ID: user123, Language: vi
2025-05-19 17:32:19,884 - app.services.travel_assistant - DEBUG - User location: {'latitude': 10.762622, 'longitude': 106.660172}
2025-05-19 17:32:19,884 - app.services.travel_assistant - INFO - Getting recommendations from OpenAI...
2025-05-19 17:32:19,887 - app.services.openai_service - DEBUG - Preparing context from travel data
2025-05-19 17:32:19,888 - app.services.openai_service - ERROR - Error preparing context: string indices must be integers
Traceback (most recent call last):
  File "D:\HOCKY8\DO_AN_TOT_NGHIEP\dev\ScapeData\model_cursor\app\services\openai_service.py", line 157, in _prepare_context
    context_parts.append(f"- {option['type']}: {option['description']}")
TypeError: string indices must be integers
2025-05-19 17:32:19,888 - app.services.openai_service - DEBUG - Prepared context length: 0
2025-05-19 17:32:19,888 - app.services.openai_service - DEBUG - Sending request to OpenAI API...
2025-05-19 17:32:19,889 - openai - DEBUG - message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
2025-05-19 17:32:19,889 - openai - DEBUG - api_version=None data='{"model": "gpt-3.5-turbo", "messages": [{"role": "system", "content": "You are a helpful travel assistant specializing in Ho Chi Minh City tourism."}, {"role": "user", "content": "Based on the following travel information about Ho Chi Minh City, please create a personalized travel itinerary.\\n\\nTravel Information:\\n\\n\\nUser Query: t\\u00f4i mu\\u1ed1n du l\\u1ecbch \\u1edf Th\\u00e0nh ph\\u1ed1 H\\u1ed3 Ch\\u00ed Minh 3 ng\\u00e0y m\\u1edbi ng\\u00e2n s\\u00e1ch 5 tri\\u1ec7u, t\\u00f4i th\\u00edch tr\\u1ea3i nghi\\u1ec7m \\u1ea9m th\\u1ef1c v\\u00e0 mua s\\u1eafm \\n\\nPlease provide a detailed response in the following JSON format:\\n{\\n    \\"itinerary\\": [\\n        {\\n            \\"day\\": 1,\\n            \\"activities\\": [\\n                {\\n                    \\"time\\": \\"HH:MM\\",\\n                    \\"name\\": \\"Activity name\\",\\n                    \\"description\\": \\"Detailed description\\",\\n                    \\"location\\": {\\n                        \\"name\\": \\"Location name\\",\\n                        \\"address\\": \\"Full address\\"\\n                    },\\n                    \\"estimated_cost\\": \\"Cost in VND\\"\\n                }\\n            ]\\n        }\\n    ],\\n    \\"tips\\": [\\n        \\"Tip 1\\",\\n        \\"Tip 2\\"\\n    ],\\n    \\"transportation\\": \\"Transportation advice\\",\\n    \\"total_cost\\": \\"Total estimated cost in VND\\"\\n}\\n\\nEnsure the itinerary is realistic, considering:\\n1. Opening hours of attractions\\n2. Travel time between locations\\n3. Local customs and culture\\n4. Weather conditions\\n5. Budget constraints\\n"}], "temperature": 0.7, "max_tokens": 2000}' message='Post details'
2025-05-19 17:32:19,889 - urllib3.util.retry - DEBUG - Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-05-19 17:32:19,891 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.openai.com:443
2025-05-19 17:32:26,743 - urllib3.connectionpool - DEBUG - https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
2025-05-19 17:32:26,751 - openai - DEBUG - message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=5103 request_id=req_1b6db7f1a779e54bb929e3d7a55664f3 response_code=200
2025-05-19 17:32:26,752 - app.services.openai_service - DEBUG - Received response from OpenAI: {
    "itinerary": [
        {
            "day": 1,
            "activities": [
                {
                    "time": "08:00",
                    "name": "Breakfast at Ben Thanh Market",
   ...
2025-05-19 17:32:26,753 - app.services.openai_service - INFO - Successfully parsed OpenAI response
2025-05-19 17:32:26,753 - app.services.travel_assistant - INFO - Adding location coordinates...
2025-05-19 17:32:26,754 - app.services.travel_assistant - DEBUG - Searching coordinates for: Ben Thanh Market
2025-05-19 17:32:26,754 - app.services.mapbox_service - INFO - Searching for place: Ben Thanh Market
2025-05-19 17:32:26,755 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Ben Thanh Market.json
2025-05-19 17:32:26,756 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:32:27,028 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Ben%20Thanh%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:32:27,035 - app.services.mapbox_service - INFO - Found coordinates: [106.617901, 10.9827]
2025-05-19 17:32:27,037 - app.services.travel_assistant - DEBUG - Found coordinates: (10.9827, 106.617901)
2025-05-19 17:32:27,037 - app.services.travel_assistant - DEBUG - Searching coordinates for: Saigon Square
2025-05-19 17:32:27,037 - app.services.mapbox_service - INFO - Searching for place: Saigon Square
2025-05-19 17:32:27,038 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Saigon Square.json
2025-05-19 17:32:27,039 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:32:27,291 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Saigon%20Square.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:32:27,292 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['saigon', 'square'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:32:27,292 - app.services.mapbox_service - WARNING - No results found for: Saigon Square
2025-05-19 17:32:27,295 - app.services.travel_assistant - WARNING - No coordinates found for: Saigon Square
2025-05-19 17:32:27,295 - app.services.travel_assistant - DEBUG - Searching coordinates for: Pho Phuong
2025-05-19 17:32:27,296 - app.services.mapbox_service - INFO - Searching for place: Pho Phuong
2025-05-19 17:32:27,296 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Pho Phuong.json
2025-05-19 17:32:27,298 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:32:27,550 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Pho%20Phuong.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:32:27,569 - app.services.mapbox_service - INFO - Found coordinates: [106.724728, 21.022371]
2025-05-19 17:32:27,571 - app.services.travel_assistant - DEBUG - Found coordinates: (21.022371, 106.724728)
2025-05-19 17:32:27,571 - app.services.travel_assistant - DEBUG - Searching coordinates for: War Remnants Museum
2025-05-19 17:32:27,571 - app.services.mapbox_service - INFO - Searching for place: War Remnants Museum
2025-05-19 17:32:27,571 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/War Remnants Museum.json
2025-05-19 17:32:27,572 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:32:27,766 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/War%20Remnants%20Museum.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:32:27,768 - app.services.mapbox_service - DEBUG - Received response: {'type': 'FeatureCollection', 'query': ['war', 'remnants', 'museum'], 'features': [], 'attribution': 'NOTICE: © 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained.'}
2025-05-19 17:32:27,769 - app.services.mapbox_service - WARNING - No results found for: War Remnants Museum
2025-05-19 17:32:27,772 - app.services.travel_assistant - WARNING - No coordinates found for: War Remnants Museum
2025-05-19 17:32:27,773 - app.services.travel_assistant - DEBUG - Searching coordinates for: Nguyen Hue Walking Street
2025-05-19 17:32:27,774 - app.services.mapbox_service - INFO - Searching for place: Nguyen Hue Walking Street
2025-05-19 17:32:27,775 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Nguyen Hue Walking Street.json
2025-05-19 17:32:27,778 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:32:28,018 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Nguyen%20Hue%20Walking%20Street.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:32:28,024 - app.services.mapbox_service - INFO - Found coordinates: [106.703671, 10.773838]
2025-05-19 17:32:28,025 - app.services.travel_assistant - DEBUG - Found coordinates: (10.773838, 106.703671)
2025-05-19 17:32:28,025 - app.services.travel_assistant - DEBUG - Searching coordinates for: Ben Thanh Street Food Market
2025-05-19 17:32:28,025 - app.services.mapbox_service - INFO - Searching for place: Ben Thanh Street Food Market
2025-05-19 17:32:28,026 - app.services.mapbox_service - DEBUG - Sending request to: https://api.mapbox.com/geocoding/v5/mapbox.places/Ben Thanh Street Food Market.json
2025-05-19 17:32:28,027 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.mapbox.com:443
2025-05-19 17:32:28,253 - urllib3.connectionpool - DEBUG - https://api.mapbox.com:443 "GET /geocoding/v5/mapbox.places/Ben%20Thanh%20Street%20Food%20Market.json?access_token=pk.eyJ1IjoidmFuZ2lhbmc0Nzg5IiwiYSI6ImNtYTY0YTc3bzBxdDUyaXE1c3hxcmM3Y3YifQ.APhUinusY7r_S5mEQarhIg&country=vn&types=poi%2Cplace%2Caddress&limit=1&language=vi&proximity=106.660172%2C10.762622 HTTP/1.1" 200 None
2025-05-19 17:32:28,262 - app.services.mapbox_service - INFO - Found coordinates: [107.451301, 10.864911]
2025-05-19 17:32:28,264 - app.services.travel_assistant - DEBUG - Found coordinates: (10.864911, 107.451301)
2025-05-19 17:32:28,264 - app.services.travel_assistant - INFO - Generating map URL...
2025-05-19 17:32:28,264 - app.services.mapbox_service - INFO - Generating static map URL...
2025-05-19 17:32:28,264 - app.services.mapbox_service - DEBUG - Center: (10.9827, 106.617901), Markers: [{'latitude': 10.9827, 'longitude': 106.617901, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 21.022371, 'longitude': 106.724728, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.773838, 'longitude': 106.703671, 'symbol': 'marker', 'color': 'ff0000'}, {'latitude': 10.864911, 'longitude': 107.451301, 'symbol': 'marker', 'color': 'ff0000'}]
2025-05-19 17:32:28,265 - app.services.mapbox_service - INFO - Static map URL generated successfully
2025-05-19 17:32:28,265 - app.services.travel_assistant - INFO - Map URL generated successfully
2025-05-19 17:32:28,265 - app.services.travel_assistant - INFO - Query processing completed successfully
2025-05-19 17:32:28,265 - app.routes.travel_routes - INFO - Query processed successfully
2025-05-19 17:32:28,266 - werkzeug - INFO - 127.0.0.1 - - [19/May/2025 17:32:28] "POST /api/travel/ask HTTP/1.1" 200 -
